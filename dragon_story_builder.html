<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Story Builder - Chinese New Year Grammar Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #C41E3A;
        }

        .header h1 {
            color: #8B0000;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            color: #C41E3A;
            font-size: 1.1em;
            font-weight: 600;
        }

        .game-area {
            padding: 40px;
            min-height: 400px;
        }

        .start-screen {
            text-align: center;
        }

        .start-screen h2 {
            color: #C41E3A;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .start-screen p {
            color: #666;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .dragon-emoji {
            font-size: 80px;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(135deg, #C41E3A 0%, #8B0000 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .story-text {
            background: #FFF9E6;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #FFD700;
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.15em;
            color: #333;
        }

        .question-section {
            margin-bottom: 30px;
        }

        .question-section h3 {
            color: #C41E3A;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .choice-btn {
            background: white;
            border: 3px solid #FFD700;
            padding: 15px 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 1.05em;
            color: #333;
        }

        .choice-btn:hover {
            background: #FFF9E6;
            border-color: #FFA500;
            transform: translateX(10px);
        }

        .choice-btn.selected {
            background: #C41E3A;
            color: white;
            border-color: #8B0000;
        }

        .choice-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #2E7D32;
        }

        .choice-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #c62828;
        }

        .progress {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700 0%, #FFA500 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8B0000;
            font-weight: bold;
        }

        .score {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #C41E3A;
            font-weight: 600;
        }

        .feedback {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 5px solid #2196F3;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback h4 {
            color: #1976D2;
            margin-bottom: 8px;
        }

        .feedback p {
            color: #555;
            line-height: 1.6;
        }

        .next-btn {
            margin-top: 20px;
            display: none;
        }

        .next-btn.show {
            display: inline-block;
        }

        .final-story {
            background: #FFF9E6;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.1em;
        }

        .final-story h2 {
            color: #C41E3A;
            text-align: center;
            margin-bottom: 20px;
        }

        .final-score {
            text-align: center;
            font-size: 2em;
            color: #4CAF50;
            margin: 20px 0;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #8B0000;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .game-area {
                padding: 20px;
            }
            
            .story-text {
                font-size: 1em;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêâ Dragon Story Builder üêâ</h1>
            <p>Build Your Chinese New Year Adventure!</p>
        </div>

        <div class="game-area">
            <!-- Start Screen -->
            <div id="startScreen" class="start-screen">
                <div class="dragon-emoji">üêâüéäüßß</div>
                <h2>Welcome, Story Builder!</h2>
                <p>Create your own Chinese New Year story by choosing the correct grammar words. Each choice you make will build the story and help you practice important English linkers!</p>
                <p><strong>Grammar Focus:</strong> also/besides, therefore/because, at first/then/after, since/so/as, and more!</p>
                
                <div style="margin: 30px 0;">
                    <input type="text" id="studentName" placeholder="Enter your name" 
                           style="padding: 15px; font-size: 1.1em; border: 3px solid #FFD700; border-radius: 10px; width: 100%; max-width: 400px; text-align: center;">
                </div>
                
                <button class="btn" onclick="startGame()">Start Building! üöÄ</button>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="hidden">
                <div class="progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                </div>

                <div class="score" id="scoreDisplay">Score: 0/8 ‚≠ê</div>

                <div class="story-text" id="storyText"></div>

                <div class="question-section">
                    <h3 id="questionText"></h3>
                    <div class="choices" id="choicesContainer"></div>
                </div>

                <div class="feedback" id="feedback">
                    <h4 id="feedbackTitle"></h4>
                    <p id="feedbackText"></p>
                </div>

                <button class="btn next-btn" id="nextBtn" onclick="nextQuestion()">Continue Story ‚Üí</button>
            </div>

            <!-- End Screen -->
            <div id="endScreen" class="hidden">
                <div class="final-story" id="finalStory"></div>
                <div class="final-score" id="finalScore"></div>
                <div class="action-buttons">
                    <button class="btn" onclick="restartGame()">Create New Story üîÑ</button>
                    <button class="btn btn-secondary" onclick="sendResults()">Send Results üìß</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const storyData = [
            {
                story: "Chinese New Year is an important traditional Chinese holiday. It is",
                question: "Choose the correct word:",
                choices: ["also", "besides", "in addition"],
                correct: 0,
                explanation: "'Also' is the most common and natural choice here. It adds information in a simple way.",
                fullSentence: "Chinese New Year is an important traditional Chinese holiday. It is also known as the Spring Festival."
            },
            {
                story: "According to legend, the holiday began",
                question: "Choose the correct word to show the reason:",
                choices: ["consequently", "therefore", "because"],
                correct: 2,
                explanation: "'Because' introduces a reason or cause. It's followed by the reason (a terrible dragon attacked).",
                fullSentence: "According to legend, the holiday began because a terrible dragon attacked the same village every year."
            },
            {
                story: "The dragon attacked every year and ate whatever it could find.",
                question: "Choose the correct time expression:",
                choices: ["At first", "Then", "After"],
                correct: 0,
                explanation: "'At first' shows the beginning of a sequence of events. It introduces what happened initially.",
                fullSentence: "At first, one day, the dragon saw a small child wearing red and it ran away."
            },
            {
                story: "The people understood that the dragon was afraid of the colour red,",
                question: "Choose the correct word to show result or reason:",
                choices: ["since", "so", "as"],
                correct: 1,
                explanation: "'So' shows result or consequence. The people understood something, SO they took action.",
                fullSentence: "The people understood that the dragon was afraid of the colour red, so they started making beautiful red paper decorations."
            },
            {
                story: "They made",
                question: "Choose the correct description:",
                choices: ["beautiful, red paper", "paper, beautiful red", "beautiful, paper red"],
                correct: 0,
                explanation: "In English, adjectives go before nouns in this order: opinion (beautiful) + color (red) + noun (paper).",
                fullSentence: "They made beautiful, red paper decorations to prevent the dragon from coming back."
            },
            {
                story: "Before the holiday, the Chinese clean their homes",
                question: "Choose the correct word:",
                choices: ["really", "fairly", "carefully"],
                correct: 2,
                explanation: "'Carefully' means with attention and care. It fits the meaning of cleaning thoroughly.",
                fullSentence: "Before the holiday, the Chinese clean their homes carefully."
            },
            {
                story: "They are cleaning away last year's bad luck",
                question: "Choose the correct phrase to show purpose:",
                choices: ["so that", "to", "in order to"],
                correct: 2,
                explanation: "'In order to' clearly shows purpose or intention. It's more formal than 'to' alone.",
                fullSentence: "They are cleaning away last year's bad luck in order to the new year's good luck can come into their homes."
            },
            {
                story: "Another tradition is fireworks.",
                question: "Choose the correct phrase to contrast:",
                choices: ["On the other hand", "Although", "However"],
                correct: 0,
                explanation: "'On the other hand' introduces a contrasting point. It shows a different perspective or situation.",
                fullSentence: "Another tradition is fireworks. On the other hand, over the years many people have been seriously injured by the fireworks, so in some places they are not allowed today."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let userChoices = [];
        let storyParts = [];
        let studentName = '';

        function startGame() {
            // Get and validate student name
            studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('Please enter your name before starting! üòä');
                return;
            }
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            currentQuestion = 0;
            score = 0;
            userChoices = [];
            storyParts = [];
            loadQuestion();
        }

        function loadQuestion() {
            const data = storyData[currentQuestion];
            const progress = ((currentQuestion + 1) / storyData.length) * 100;
            
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = Math.round(progress) + '%';
            
            // Build story so far
            let fullStory = storyParts.join(' ');
            if (fullStory) {
                fullStory += ' ' + data.story;
            } else {
                fullStory = data.story;
            }
            
            document.getElementById('storyText').innerHTML = fullStory + ' <strong style="color: #C41E3A;">___</strong>';
            document.getElementById('questionText').textContent = data.question;
            
            // Create choices
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            data.choices.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice;
                btn.onclick = () => selectAnswer(index);
                choicesContainer.appendChild(btn);
            });
            
            document.getElementById('feedback').classList.remove('show');
            document.getElementById('nextBtn').classList.remove('show');
        }

        function selectAnswer(selected) {
            const data = storyData[currentQuestion];
            const choices = document.querySelectorAll('.choice-btn');
            
            // Disable all choices
            choices.forEach((btn, index) => {
                btn.onclick = null;
                if (index === data.correct) {
                    btn.classList.add('correct');
                } else if (index === selected) {
                    btn.classList.add('incorrect');
                }
            });
            
            // Show feedback
            const feedback = document.getElementById('feedback');
            const feedbackTitle = document.getElementById('feedbackTitle');
            const feedbackText = document.getElementById('feedbackText');
            
            if (selected === data.correct) {
                score++;
                feedbackTitle.textContent = '‚úÖ Excellent!';
                feedbackTitle.style.color = '#4CAF50';
            } else {
                feedbackTitle.textContent = '‚ùå Not quite right';
                feedbackTitle.style.color = '#f44336';
            }
            
            feedbackText.textContent = data.explanation;
            feedback.classList.add('show');
            
            // Store the complete sentence
            storyParts.push(data.fullSentence);
            userChoices.push({
                question: currentQuestion + 1,
                selected: data.choices[selected],
                correct: data.choices[data.correct],
                isCorrect: selected === data.correct
            });
            
            // Update score display
            document.getElementById('scoreDisplay').textContent = `Score: ${score}/${storyData.length} ‚≠ê`;
            
            // Show next button
            document.getElementById('nextBtn').classList.add('show');
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion < storyData.length) {
                loadQuestion();
            } else {
                showFinalStory();
            }
        }

        function showFinalStory() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('endScreen').classList.remove('hidden');
            
            // Display complete story
            const finalStory = document.getElementById('finalStory');
            finalStory.innerHTML = '<h2>üéâ Your Complete Story! üéâ</h2>' + storyParts.join(' ');
            
            // Display score
            const percentage = Math.round((score / storyData.length) * 100);
            let message = '';
            let emoji = '';
            
            if (percentage >= 80) {
                message = 'Outstanding! üåü';
                emoji = 'üèÜ';
            } else if (percentage >= 60) {
                message = 'Great work! üëè';
                emoji = '‚≠ê';
            } else {
                message = 'Keep practicing! üí™';
                emoji = 'üìö';
            }
            
            document.getElementById('finalScore').innerHTML = 
                `${emoji} ${score}/${storyData.length} Correct (${percentage}%)<br><small style="font-size: 0.5em;">${message}</small>`;
        }

        function restartGame() {
            document.getElementById('endScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        function sendResults() {
            // YOU NEED TO REPLACE THIS URL WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzjpYMyXcyXgrmnBkIiOTRExfiEYU9SD4md7Oa-TMDMVTAYj90qNdn1ZwE6zWMSwzpG/exec';
            
            const story = storyParts.join(' ');
            const percentage = Math.round((score / storyData.length) * 100);
            
            // Prepare detailed results for each question
            const detailedAnswers = userChoices.map(choice => ({
                question: choice.question,
                studentAnswer: choice.selected,
                correctAnswer: choice.correct,
                isCorrect: choice.isCorrect
            }));
            
            // Prepare data to send
            const data = {
                timestamp: new Date().toLocaleString(),
                studentName: studentName,
                score: score,
                total: storyData.length,
                percentage: percentage,
                story: story,
                answers: detailedAnswers
            };
            
            // Show loading message
            const sendButton = event.target;
            sendButton.disabled = true;
            sendButton.textContent = 'Sending... ‚è≥';
            
            // Send to Google Sheets
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                // Success - no-cors mode doesn't return response
                alert(`‚úÖ Results sent successfully!\n\nThank you, ${studentName}!\n\nYour score: ${score}/${storyData.length} (${percentage}%)`);
                sendButton.textContent = '‚úì Results Sent!';
                sendButton.style.background = '#4CAF50';
            })
            .catch(error => {
                // Error handling
                console.error('Error:', error);
                alert('‚ùå There was a problem sending your results. Please tell your teacher.');
                sendButton.disabled = false;
                sendButton.textContent = 'Send Results üìß';
            });
        }
    </script>
</body>
</html>